[tools]
"go" = "1.24.4"
"node" = "22"

[tasks.copy-wasm-shim]
alias = ["gojs"]
description = "Copies Go's wasm_exec.js to the public directory"
run = [
	"echo $(go version) > public/wasm_exec.js",
	"cat $(go env GOROOT)/lib/wasm/wasm_exec.js >> public/wasm_exec.js",
]

[tasks.build-go-wasm]
alias = ["wasm"]
depends = ["copy-wasm-shim"]
description = "Builds the Go WebAssembly module for Tailscale SSH"
env = { GOOS = "js", GOARCH = "wasm" }
run = "go build -o public/hp_ssh.wasm ./cmd/hp_ssh"

[tasks.generate-caddy-certs]
alias = ["mkcert"]
dir = "{{cwd}}/test/caddy/certs"
run = [
	"mkdir -p {{cwd}}/test/caddy/certs",
	"mkcert -install",
	"mkcert localhost"
]
